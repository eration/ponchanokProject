<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <link rel="stylesheet" type="text/css" href="jqm/jquery.mobile.flatui.css" />
    <title>Math</title>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="jqm/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="jqm/jquery.mobile-1.4.5.min.js"></script>
    <style>
        table,tr,td,th{
                    text-align: center;
                    border: 1px solid black;
        }
    </style>
    <script>
        var db;
        var soundModel = {};
        soundModel.gameOver = new Audio("sound/Game_Over.wav");
        soundModel.invalid = new Audio("sound/Invalid.wav");
        soundModel.slideClick = new Audio("sound/slide_click.mp3");
        soundModel.valid = new Audio("sound/Valid.wav");
        soundModel.backgound = new Audio("sound/backgroundSound.mp3");
        var fastMathModel = {};
        fastMathModel.isPlaySound = true;
        fastMathModel.game = "";
        fastMathModel.mode = "";
        fastMathModel.ansNumber = "";
        fastMathModel.questionNumber = [];
        fastMathModel.questionOpp = "";
        fastMathModel.selectNumber = [];
        fastMathModel.time = 0;
        fastMathModel.score = 0;
        fastMathModel.timeInterval = "";
        fastMathModel.playerName = "";
        fastMathModel.rowList = [];
        
        $(function(){
            db = window.openDatabase("HighScoreDB","1.0","High Score",1024 * 1024);
            db.transaction(function(tx){
//            tx.executeSql("DROP TABLE IF EXISTS HIGH_SCORE");
            var sql = "CREATE TABLE IF NOT EXISTS HIGH_SCORE ("+
                "HIGHSCORE_ID INTEGER PRIMARY KEY AUTOINCREMENT,"+
                "SCORE INTEGER,"+
                "MODE INTEGER,"+
                "GAME INTEGER,"+
                "NAME VARCHAR(50)"+
                ")";
            tx.executeSql(sql);
            },onError,onSuccess);
            soundModel.backgound.play();
            soundModel.backgound.loop = true;
        });

        function onSuccess(){
//            alert("Query Success");
        }

        function onError(){
            alert("Query Error");
        }
        
        function onChangePage(page){
            $.mobile.changePage(page);
            playSound(soundModel.slideClick);
        }
        
        function playSound(sound){
            if (fastMathModel.isPlaySound)
                sound.play();
        }
        
        function changePlaySound(){
            if (soundModel.backgound.muted) {
                soundModel.backgound.muted = false;
            } else {
                soundModel.backgound.muted = true;
            }
            
        }
        
        function changePlayEffect(){
            fastMathModel.isPlaySound = !fastMathModel.isPlaySound;
        }
        
        function selectGame(game){
            fastMathModel.game = game;
            onChangePage("#modePage");
        }
        
        function selectMode(mode){
            fastMathModel.mode = mode;
            fastMathModel.score = 0;
            setGameMode();
            $("#showScore").html("คะแนน : 0 คะแนน");
        }
        
        function setGameMode(){
            var numberMin;
            var numberMax;
            var numOpp;
            if (fastMathModel.mode == "Easy") {
                numberMin = 1;
                numberMax = 9;
            } else if (fastMathModel.mode == 'Normal') {
                numberMin = 10;
                numberMax = 99;
            } else {
                numberMin = 100;
                numberMax = 999;
            }
            for (var i=0;i<2;i++)
                fastMathModel.questionNumber[i] = getRandomNumber(numberMin,numberMax);
            if (fastMathModel.game == "Mode2")
                numOpp = 4;
            else 
                numOpp = 2;
            numOpp = getRandomNumber(1,numOpp);
            if (numOpp==1) {
                fastMathModel.ansNumber = fastMathModel.questionNumber[0] + fastMathModel.questionNumber[1];
                fastMathModel.questionOpp = '+';
            } else if (numOpp == 2) {
                fastMathModel.ansNumber = fastMathModel.questionNumber[0] - fastMathModel.questionNumber[1];
                fastMathModel.questionOpp = '-';
            } else if (numOpp == 3) {
                fastMathModel.ansNumber = fastMathModel.questionNumber[0] * fastMathModel.questionNumber[1];
                fastMathModel.questionOpp = 'x';
            } else {
                fastMathModel.ansNumber = (fastMathModel.questionNumber[0] / fastMathModel.questionNumber[1]).toFixed(2);
                fastMathModel.questionOpp = '/';
            }
            if (fastMathModel.game == "Mode1"){
                $("#quest2").html(fastMathModel.questionOpp);
                $("#quest5").html("?");
                fastMathModel.selectNumber[0] = fastMathModel.ansNumber;
                if (fastMathModel.mode == 'Easy'){
                    fastMathModel.selectNumber[1] = fastMathModel.ansNumber + 4;
                    fastMathModel.selectNumber[2] = fastMathModel.ansNumber + 2;
                    fastMathModel.selectNumber[3] = fastMathModel.ansNumber - 2;
                } else if (fastMathModel.mode == 'Normal'){
                    fastMathModel.selectNumber[1] = fastMathModel.ansNumber + 40;
                    fastMathModel.selectNumber[2] = fastMathModel.ansNumber + 100;
                    fastMathModel.selectNumber[3] = fastMathModel.ansNumber - 20;
                } else {
                    fastMathModel.selectNumber[1] = fastMathModel.ansNumber + 600;
                    fastMathModel.selectNumber[2] = fastMathModel.ansNumber + 200;
                    fastMathModel.selectNumber[3] = fastMathModel.ansNumber - 600;
                }
                shuffle(fastMathModel.selectNumber);
            } else {
                $("#quest2").html("?");
                $("#quest5").html(fastMathModel.ansNumber);
                fastMathModel.ansNumber = fastMathModel.questionOpp;
                fastMathModel.selectNumber[0] = '+';
                fastMathModel.selectNumber[1] = '-';
                fastMathModel.selectNumber[2] = 'x';
                fastMathModel.selectNumber[3] = '/';
            }
            $("#ans1").html(fastMathModel.selectNumber[0]);
            $("#ans2").html(fastMathModel.selectNumber[1]);
            $("#ans3").html(fastMathModel.selectNumber[2]);
            $("#ans4").html(fastMathModel.selectNumber[3]);
            $("#quest1").html(fastMathModel.questionNumber[0]);
            $("#quest3").html(fastMathModel.questionNumber[1]);
            $("#quest4").html("=");
            fastMathModel.time = 20;
            $("#showTime").html("เวลา : " + fastMathModel.time);
            clearInterval(fastMathModel.timeInterval);
            setTimeInterval();
            onChangePage("#playPage");   
        }
        
        function setTimeInterval(){
            fastMathModel.timeInterval = setInterval(function(){
                fastMathModel.time--;
                $("#showTime").html("เวลา : " + fastMathModel.time);
                if (fastMathModel.time<=0) {
                    clearInterval(fastMathModel.timeInterval);
                    playSound(soundModel.invalid);
                    $("#gameOverScore").html("คะแนนที่ทำได้ : " + fastMathModel.score);
                    onChangePage("#gameOverPage");
                }
            },1000);
        }
        
        function getRandomNumber(min,max){
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function shuffle(a) {
            var j, x, i;
            for (i = a.length; i; i--) {
                j = Math.floor(Math.random() * i);
                x = a[i - 1];
                a[i - 1] = a[j];
                a[j] = x;
            }     
        }
        
        function checkResult(e){
            var currentAns = $(e).html();
            if (currentAns == fastMathModel.ansNumber){
                playSound(soundModel.valid);
                fastMathModel.score++;
                $("#showScore").html("คะแนน : " + fastMathModel.score + "คะแนน");
                setGameMode();
            } else {
                playSound(soundModel.invalid);
                alert("เฉลย : " + fastMathModel.ansNumber);
                $("#gameOverScore").html("คะแนนที่ทำได้ : " + fastMathModel.score + "คะแนน");
                onChangePage("#gameOverPage");
            }
        }
        
        function onSave(){
            fastMathModel.playerName = $("#inName").val();
            db.transaction(function(tx){
                var sql = "INSERT INTO HIGH_SCORE(" +
                    "SCORE,"+
                    "MODE,"+
                    "NAME,"+
                    "GAME"+
                    ") VALUES(?,?,?,?)";
                tx.executeSql(sql,[fastMathModel.score,fastMathModel.mode,fastMathModel.playerName,fastMathModel.game],insertSuccess);
            });
        }
        
        function insertSuccess(){
            alert("บันทึกสำเร็จ");
            onChangePage("#homePage");
        }
        
        function showStat(){
            db.transaction(function(tx){
                var sql = "SELECT * FROM HIGH_SCORE";
                tx.executeSql(sql,[],onShowList);
            });
        }
        
        function onShowList(tx,list){
            fastMathModel.rowList = [];
            var len = list.rows.length;
            var contentList;
            $("#EasyScoreMode1,#EasyScoreMode2,#NormalScoreMode1,#NormalScoreMode2,#HardScoreMode1,#HardScoreMode2").empty();
            for (var i=0;i<len;i++){
                var elementId = "";
                var rec = list.rows.item(i);
                var _name = rec.NAME;
                var _game = rec.GAME;
                var _mode = rec.MODE;
                var _score = rec.SCORE;
                contentList = "<tr align='center' valign='middle' ><td>"+_name+"</td><td align='center' valign='middle' >"+_score+"</td></tr>";
                elementId = "#" + _mode + "Score" + _game;
                $(elementId).append(contentList);
            }
            onChangePage("#showStatPage");
        }
        
    </script>
    <style>
        #homePage,#modePage,#playPage,#gameOverPage,#showStatPage{
            background: url(img/backGroundImg.png) no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
        }
        .whiteTranparent{
            background: RGBA(255,255,255,0.8);
                    border: 1px solid black;
                    border-radius: 10%;
                    font-family: sans-serif;
                    font-style: bold;
        }
    </style>
</head>

<body>
<!--    mainPage-->
    <div data-role="page" id="homePage" data-theme="g">
        <div data-role="header">
            <h3>คณิตคิดเร็ว</h3>
        </div>
        <div data-role="content">
            <br><br><br><br><br><br>
            <a href="#" data-role="button" id="btnMode1" onclick="selectGame('Mode1')">หาผลลัพธ์</a>
            <br>
            <a href="#" data-role="button" id="btnMode2" onclick="selectGame('Mode2')">หาเครื่องหมาย</a>
            <br>
            <a href="#" data-role="button" id="btnStat" onclick="showStat();">สถิติ</a>
            <br>
            <a href="#" data-role="button" onclick="onChangePage('#learnPage')">เนื้อหา</a>
            <center>
                <div class="ui-grid-a whiteTranparent">
                    <div class="ui-block-a">
                        <label>Music</label>
                        <input type="checkbox" data-role="flipswitch" name="musicSwitch" id="musicSwitch" data-theme="d" onchange="changePlaySound();" checked>
                    </div>
                    <div class="ui-block-b">
                        <label>Effect</label>
                        <input type="checkbox" data-role="flipswitch" name="effectSwitch" id="effectSwith" data-theme="d" onchange="changePlayEffect();" checked>
                    </div>
                </div>
            </center>
        </div>
    </div>
<!--    learnPage-->
    <div data-role="page" id="learnPage" data-theme="g">
        <div data-role="header">
            <h3>เนื้อหา</h3>
        </div>
        <div data-role="content">
            <iframe width="100%" height="300" src="https://www.youtube.com/embed/IgKUKd5PURc"></iframe>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-role="button" onclick="onChangePage('#homePage')">ย้อนกลับ</a></li>
                </ul>
            </div>
        </div> 
    </div>
<!--    modePage-->
    <div data-role="page" id="modePage" data-theme="g">
        <div data-role="header">
            <h3>ระดับความยาก</h3>
        </div>
        <div data-role="content">
            <br><br><br><br>
            <a href="#" data-role="button" id="btnEasy" onclick="selectMode('Easy')">ง่าย</a>
            <a href="#" data-role="button" id="btnNormal" onclick="selectMode('Normal')">ปานกลาง</a>
            <a href="#" data-role="button" id="btnHard" onclick="selectMode('Hard')">ยาก</a>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-role="button" id="btnBackHome" onclick="onChangePage('#homePage')">Back</a></li>
                </ul>
            </div>
        </div> 
    </div>
<!--    playPage-->
    <div data-role="page" id="playPage" data-theme="g">
        <div data-role="content">
            <div class="whiteTranparent">
                <div class="ui-grid-a">
                <div class="ui-block-a">
                    <center><label id="showTime"></label></center>
                </div>
                <div class="ui-block-b">
                    <center><label id="showScore"></label></center>
                </div>
            </div>
            <br>
            <center>
                <div class="ui-grid-d">
                    <div class="ui-block-a">
                        <label class="grey" id="quest1"></label>
                    </div>
                    <div class="ui-block-b">
                        <label class="grey" id="quest2"></label>
                    </div>
                    <div class="ui-block-c">
                        <label class="grey" id="quest3"></label>
                    </div>
                    <div class="ui-block-d">
                        <label class="grey" id="quest4"></label>
                    </div>
                    <div class="ui-block-e">
                        <label class="grey" id="quest5"></label>
                    </div>
                </div>
            </center>
            </div>
            <br>
            <a href="#" data-role="button" id="ans1" onclick="checkResult(this);"></a>
            <a href="#" data-role="button" id="ans2" onclick="checkResult(this);"></a>
            <a href="#" data-role="button" id="ans3" onclick="checkResult(this);"></a>
            <a href="#" data-role="button" id="ans4" onclick="checkResult(this);"></a>
        </div>
    </div>
<!--    gameOverPage-->
    <div data-role="page" id="gameOverPage" data-theme="g">
        <div data-role="header">
            <h3>GameOver</h3>
        </div>
        <div data-role="content">
            <br><br><br>
            <center >
                <input type="text" placeholder="กรุณาใส่ชื่อ" value="" id="inName">
                <br><br>
                <p id="gameOverScore" class='whiteTranparent'></p>
            </center>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-role="button" onclick="onSave();">Save</a></li>
                    <li><a href="#" data-role="button" onclick="onChangePage('#homePage');">Back</a></li>
                </ul>
            </div>
        </div> 
    </div>
<!--    showList-->
    <div data-role="page" id="showStatPage">
        <div data-role="header">
            <h3>Statistic</h3>
        </div>
        <div data-role="content">
            <center class="whiteTranparent">
                <div >
                    <label>หาผลลัพธ์</label>
                <br>
                <label>ง่าย</label>
                <br>
                <table >
                    <thead>
                        <th>ชื่อผู้เล่น</th>
                        <th>คะแนน</th>
                    </thead>
                    <tbody id="EasyScoreMode1">
                        
                    </tbody>
                </table>
                </div>
                <br>
                <label>ปานกลาง</label>
                <br>
                <table >
                    <thead>
                        <th>ชื่อผู้เล่น</th>
                        <th>คะแนน</th>
                    </thead>
                    <tbody id="NormalScoreMode1">
                        
                    </tbody>
                </table>
                <br>
                <label>ยาก</label>
                <br>
                <table >
                    <thead>
                        <th>ชื่อผู้เล่น</th>
                        <th>คะแนน</th>
                    </thead>
                    <tbody id="HardScoreMode1">
                        
                    </tbody>
                </table>
                <br>
                <br>
                <label>หาเครื่องหมาย</label>
                <br>
                <label>ง่าย</label>
                <br>
                <table >
                    <thead>
                        <th>ชื่อผู้เล่น</th>
                        <th>คะแนน</th>
                    </thead>
                    <tbody id="EasyScoreMode2">
                        
                    </tbody>
                </table>
                <br>
                <label>ปานกลาง</label>
                <br>
                <table >
                    <thead>
                        <th>ชื่อผู้เล่น</th>
                        <th>คะแนน</th>
                    </thead>
                    <tbody id="NormalScoreMode2">
                        
                    </tbody>
                </table>
                <br>
                <label>ยาก</label>
                <br>
                <table >
                    <thead>
                        <th>ชื่อผู้เล่น</th>
                        <th>คะแนน</th>
                    </thead>
                    <tbody id="HardScoreMode2">
                        
                    </tbody>
                </table>
            </center>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-role="button" onclick="onChangePage('#homePage')">Back</a></li>
                </ul>
            </div>
        </div> 
    </div>
<!--
    <div data-role="page">
        <div data-role="header">
            <h3></h3>
        </div>
        <div data-role="content">
        
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-role="button"></a></li>
                </ul>
            </div>
        </div> 
    </div>
-->
</body>

</html>